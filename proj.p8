pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--main
function _init()
	state="start"
	tl=0
	putbacks={}
	setup()
end

function _update()
	if state=="main" then
		player_update()
	elseif state=="start" then
		if btnp(❎) then
			state="main"
		end
	elseif state=="over" then
		if btnp(❎) then
			setup()
			state="start"
		end
	end

	lvl_update()
end

function _draw()
	cls()
	
	if state=="main" then
		map(0,0)

		--change timelines
		if tl==1 then	
			map(0,45)
		elseif tl==2 then	
			map(43,0)
		elseif tl==3 then	
			map(45,44)
		end

		spr(1,px,py,1,1,flp)
		pickup()
		draw_cam()
		draw_ui()
	elseif state=="start" then
		menu()
	elseif state=="over" then
		gameover()
	end

end 


function setup()
	player_init()
	
	for i in all(putbacks) do
		mset(i.x,i.y,i.s)
	end
	
	putbacks={}
end
-->8
--player
function player_init()
		px,py = 63,63 --pos
		flp = false
		health = 5
		paper = 0
		cx,cy = 0,0
end

function player_update()
	local lx,ly=px,py --save curr pos

 if btn(⬅️) then
	 px-=1
		flp = true
 elseif btn(➡️) then
  px+=1
  flp = false
 end
	
 if btn(⬆️) then
  py-=1
 elseif btn(⬇️) then
  py+=1
 end	
 
	local ptx,pty=(px+4)/8,(py+4)/8
	
 if fget(mget(ptx,pty),0)==true then
 	px=lx
 	py=ly
 end
 
 if health<=0 then
		state="over"
		win=false
 end

 if btnp(❎) then
	tl+=1
 end
	
end


function pickup()

	local ptx=(px+4)/8
	local pty=(py+4)/8
		
	sprover=mget(ptx,pty)
	
	--heart
	if(sprover == 9) then
		mset(ptx,pty,2)
		--save pos in table
		add(putbacks,{x=ptx,y=pty,s=9})
		health += 2  
	end
	
	--nail
	if(sprover == 8) then
		mset(ptx,pty,2)
		add(putbacks,{x=ptx,y=pty,s=8})
		health -= 5
	end
	
	--paper
	if(sprover == 6) then
		mset(ptx,pty,2)
		add(putbacks,{x=ptx,y=pty,s=6})
		paper += 2
	end
	
	
end

-->8
--levels
function lvlin()
	goal=2 --win condition
	putbacks={}
end

function lvlupdate()

end 
-->8
--scenes + ui
function menu()
	print("press ❎ to start",cx+30,cy+50)
	player_init() --reset player
end

function draw_ui()
	print("health: ".. health,cx,cy)
	print("papers: ".. paper,cx,cy+10)
	
	--progress bar
--	print("progress: ".. progress,cx+30,cy+20)
end

function draw_cam()
	cx=px-40
	cy=py-40
	camera(cx,cy)
end

function gameover()
	print("gameover!",cx+40,cy+40)
	
	if win then
		print("you win!",cx+40,cy+50)
	elseif win!=true then
		print("you lose!",cx+40,cy+50)
	end
	
	print("press ❎ to play again",cx+15,cy+70)

end
__gfx__
0000000017e11c711111111166666666555555551111111167777766111111111111111111111111000000000000000000000000000000000000000000000000
0000000017e11c71111111116666666655555555111111117777777611567677156666711e811e81000000000000000000000000000000000000000000000000
007007007777777711111111666666665555555511777511755555761576766715566671e888e888000000000000000000000000000000000000000000000000
0007700077c77e7711111111666666665555555517666651777777761576766711165111e8888888000000000000000000000000000000000000000000000000
000770007777777711111111666666665555555517666651755555761576766711167111e8888888000000000000000000000000000000000000000000000000
0070070077777777111111116666666655555555166665517777777615667671111651111e888881000000000000000000000000000000000000000000000000
000000001c7777e11111111166666666555555551111111175555576111111111116711111e88811000000000000000000000000000000000000000000000000
000000001171171111111111666666665555555511111111777777761111111111111111111e8111000000000000000000000000000000000000000000000000
__gff__
0000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020208020202020205020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0206020202020202020202020902020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202090205020202020205020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020502020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202070202020802020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0207020202020202020202020208020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020205020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0902020205020206020202020902050202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
